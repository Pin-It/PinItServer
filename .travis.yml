language: python
services: postgresql
python: '3.6'

# install dependencies
before_install:
  - openssl enc -aes-256-cbc -d -base64
    -in pinit-firebase-adminsdk.json.enc -out pinit-firebase-adminsdk.json
    -K $encrypted_45046c08f53f_key -iv $encrypted_45046c08f53f_iv
  - pip install pipenv
install: pipenv install

# testing
before_script: psql -c 'CREATE DATABASE test_db;' -U postgres
env: DATABASE_URL=postgres://postgres@localhost/test_db
script: python manage.py test

# deploy to heroku
deploy:
  provider: heroku
  api_key: $HEROKU_API_KEY
  app: pin-it-app
  on:
    repo: Pin-It/PinItServer